<!DOCTYPE html>
<html>

<head>
    <title>Mac Automation Dashboard</title>
    <script>
        let macUser = "";
        let macIp = "";

        async function checkConnection() {
            macUser = document.getElementById("mac_user").value;
            macIp = document.getElementById("mac_ip").value;

            if (!macUser || !macIp) {
                alert("Enter both Mac Username and IP!");
                return;
            }

            try {
                let resp = await fetch("http://127.0.0.1:5001/check_connection", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ mac_user: macUser, mac_ip: macIp })
                });
                let result = await resp.json();
                if (result.success) {
                    alert("Connection pingable to " + macUser + "@" + macIp);
                } else {
                    alert("Connection failed: " + result.output);
                }
            } catch (err) {
                alert("helper.py not running on this device!");
            }
        }

        async function runScript(scriptName, args = []) {
            if (!macUser || !macIp) {
                alert("Connect to the device first!");
                return;
            }

            const payload = {
                mac_user: macUser,
                mac_ip: macIp,
                script: scriptName,
                args: args
            };

            try {
                let resp = await fetch("http://127.0.0.1:5001/run_script", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });
                let result = await resp.json();
                if (result.success && result.command) {
                    alert("Command sent");
                } else {
                    alert("Failed: " + (result.output || "Unknown error"));
                }
            } catch (err) {
                alert("helper.py is not running in this device!");
            }
        }

        function handleRegisterConnect(type) {
            const var_fqdn = document.getElementById("fqdn").value;
            const var_ent_name = document.getElementById("ent_name").value;
            const var_user_id = document.getElementById("user_id").value;
            const var_user_pw = document.getElementById("user_pw").value;

            if (!var_fqdn || !var_ent_name || !var_user_id || !var_user_pw) {
                alert("Enter the credentials!");
                return;
            }

            const args = [var_fqdn, var_ent_name, var_user_id, var_user_pw];
            runScript(type === "register" ? "auto3.scpt" : "auto3.scpt", args);
        }
    </script>
</head>

<body>
    <h1>Mac Automation</h1>

    <div>
        <label>Mac Username:</label>
        <input type="text" id="mac_user"><br><br>
        <label>Mac IP:</label>
        <input type="text" id="mac_ip"><br><br>
        <button onclick="checkConnection()">Connect</button>
    </div>

    <hr>

    <h3>VPN Credentials (for Register/Connect)</h3>
    <label>Enter FQDN:</label>
    <input type="text" id="fqdn"><br><br>
    <label>Enter Enterprise Name:</label>
    <input type="text" id="ent_name"><br><br>
    <label>Enter User ID:</label>
    <input type="text" id="user_id"><br><br>
    <label>Enter User Password:</label>
    <input type="password" id="user_pw"><br><br>

    <hr>

    <h3>Automation Options</h3>
    <button onclick="runScript('sometest.scpt')">Some Test</button>
    <button onclick="handleRegisterConnect('register')">Register</button>
    <button onclick="handleRegisterConnect('connect')">Connect</button>
    <button onclick="runScript('disconnect.scpt')">Disconnect</button>
    <button onclick="runScript('fetching_details.scpt')">Fetch Details</button>
    <button onclick="runScript('uninstall_SASE.scpt')">Uninstall</button><br>

    <hr>

    <a target="_blank" href="https://github.com/SiddharthJali/auto3/blob/main/helper.py">Download the helper.py file</a>
</body>

</html>